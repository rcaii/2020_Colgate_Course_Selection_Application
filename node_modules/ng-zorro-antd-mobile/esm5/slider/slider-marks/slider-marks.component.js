import { __assign, __decorate, __metadata } from "tslib";
import { Component, OnInit, ElementRef, Input, Output, EventEmitter, AfterViewInit, HostBinding, ViewEncapsulation } from '@angular/core';
var SliderMarksComponent = /** @class */ (function () {
    function SliderMarksComponent(_elf) {
        this._elf = _elf;
        this.markArray = [];
        this._min = 0;
        this._max = 100;
        this._marks = {};
        this._included = true;
        this._className = 'am-slider-mark';
        this.onChange = new EventEmitter();
        this.onAfterChange = new EventEmitter();
    }
    Object.defineProperty(SliderMarksComponent.prototype, "min", {
        set: function (value) {
            if (value && value <= this._max) {
                this._min = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderMarksComponent.prototype, "max", {
        set: function (value) {
            if (value && value >= this._min) {
                this._max = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderMarksComponent.prototype, "marks", {
        set: function (value) {
            this._marks = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderMarksComponent.prototype, "included", {
        set: function (value) {
            this._included = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderMarksComponent.prototype, "upperBound", {
        set: function (value) {
            if (value && value !== this._upperBound) {
                this._upperBound = value;
                this.setActiveCls();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderMarksComponent.prototype, "lowerBound", {
        set: function (value) {
            if (value && value !== this.lowerBound) {
                this._lowerBound = value;
                this.setActiveCls();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderMarksComponent.prototype, "class", {
        get: function () {
            return this._className;
        },
        enumerable: true,
        configurable: true
    });
    SliderMarksComponent.prototype.getMarks = function (marksKeys) {
        var _this = this;
        this.markArray = [];
        marksKeys
            .map(parseFloat)
            .sort(function (a, b) { return a - b; })
            .map(function (point) {
            var _a;
            var markItem = {
                markLabel: '',
                point: '',
                className: {},
                style: {}
            };
            var markPoint = _this._marks[point];
            var markPointIsObject = typeof markPoint === 'object';
            var markLabel = markPointIsObject ? markPoint.label : markPoint;
            if (!markLabel && markLabel !== 0) {
                return null;
            }
            var isActive = (!_this._included && point === _this._upperBound) ||
                (_this._included && point <= _this._upperBound && point >= _this._lowerBound);
            var markClassName = (_a = {},
                _a[_this._className + "-text"] = true,
                _a[_this._className + "-text-active"] = isActive,
                _a);
            var bottomStyle = {
                marginBottom: '-50%',
                bottom: ((point - _this._min) / _this._range) * 100 + "%"
            };
            var leftStyle = {
                width: _this._markWidth + "%",
                marginLeft: -_this._markWidth / 2 + "%",
                left: ((point - _this._min) / _this._range) * 100 + "%"
            };
            var style = leftStyle;
            var markStyle = markPointIsObject ? __assign(__assign({}, style), markPoint.style) : style;
            markItem.markLabel = markLabel;
            markItem.point = point;
            markItem.className = Object.keys(markClassName).join(' ');
            markItem.style = markStyle;
            _this.markArray.push(markItem);
        });
    };
    SliderMarksComponent.prototype.setActiveCls = function () {
        var _a;
        for (var i = 0; i < this.markArray.length; i++) {
            var point = this.markArray[i].point;
            var isActive = (!this._included && point === this._upperBound) ||
                (this._included && point <= this._upperBound && point >= this._lowerBound);
            this.markArray[i].className = (_a = {},
                _a[this._className + "-text"] = true,
                _a[this._className + "-text-active"] = isActive,
                _a);
        }
    };
    SliderMarksComponent.prototype.setMarksLable = function () {
        for (var i = 0; i < this.markArray.length; i++) {
            var markEle = this._elf.nativeElement.getElementsByClassName(this._className + '-text')[i];
            markEle.innerHTML = this.markArray[i].markLabel;
        }
    };
    SliderMarksComponent.prototype.ngOnInit = function () {
        var marksKeys = Object.keys(this._marks);
        var marksCount = marksKeys.length;
        var unit = marksCount > 1 ? 100 / (marksCount - 1) : 100;
        this._markWidth = unit * 0.9;
        this._range = this._max - this._min;
        this.getMarks(marksKeys);
    };
    SliderMarksComponent.prototype.ngAfterViewInit = function () {
        this.setMarksLable();
    };
    SliderMarksComponent.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Number),
        __metadata("design:paramtypes", [Number])
    ], SliderMarksComponent.prototype, "min", null);
    __decorate([
        Input(),
        __metadata("design:type", Number),
        __metadata("design:paramtypes", [Number])
    ], SliderMarksComponent.prototype, "max", null);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], SliderMarksComponent.prototype, "marks", null);
    __decorate([
        Input(),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], SliderMarksComponent.prototype, "included", null);
    __decorate([
        Input(),
        __metadata("design:type", Number),
        __metadata("design:paramtypes", [Number])
    ], SliderMarksComponent.prototype, "upperBound", null);
    __decorate([
        Input(),
        __metadata("design:type", Number),
        __metadata("design:paramtypes", [Number])
    ], SliderMarksComponent.prototype, "lowerBound", null);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], SliderMarksComponent.prototype, "onChange", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], SliderMarksComponent.prototype, "onAfterChange", void 0);
    __decorate([
        HostBinding(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [])
    ], SliderMarksComponent.prototype, "class", null);
    SliderMarksComponent = __decorate([
        Component({
            selector: 'SliderMarks, nzm-slider-marks',
            template: "<span *ngFor=\"let item of markArray\" [ngClass]=\"item.className\" [ngStyle]=\"item.style\"> </span>\n",
            encapsulation: ViewEncapsulation.None
        }),
        __metadata("design:paramtypes", [ElementRef])
    ], SliderMarksComponent);
    return SliderMarksComponent;
}());
export { SliderMarksComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGVyLW1hcmtzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXpvcnJvLWFudGQtbW9iaWxlLyIsInNvdXJjZXMiOlsic2xpZGVyL3NsaWRlci1tYXJrcy9zbGlkZXItbWFya3MuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixVQUFVLEVBQ1YsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osYUFBYSxFQUNiLFdBQVcsRUFDWCxpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFPdkI7SUF5REUsOEJBQW9CLElBQWdCO1FBQWhCLFNBQUksR0FBSixJQUFJLENBQVk7UUF4RHBDLGNBQVMsR0FBZSxFQUFFLENBQUM7UUFFbkIsU0FBSSxHQUFXLENBQUMsQ0FBQztRQUNqQixTQUFJLEdBQVcsR0FBRyxDQUFDO1FBQ25CLFdBQU0sR0FBVyxFQUFFLENBQUM7UUFDcEIsY0FBUyxHQUFZLElBQUksQ0FBQztRQUMxQixlQUFVLEdBQVcsZ0JBQWdCLENBQUM7UUF5QzlDLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBRW5DLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztJQU9ELENBQUM7SUEzQ3hDLHNCQUFJLHFDQUFHO2FBQVAsVUFBUSxLQUFhO1lBQ25CLElBQUksS0FBSyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO2dCQUMvQixJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQzthQUNuQjtRQUNILENBQUM7OztPQUFBO0lBRUQsc0JBQUkscUNBQUc7YUFBUCxVQUFRLEtBQWE7WUFDbkIsSUFBSSxLQUFLLElBQUksS0FBSyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7Z0JBQy9CLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO2FBQ25CO1FBQ0gsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSx1Q0FBSzthQUFULFVBQVUsS0FBYTtZQUNyQixJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUN0QixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDBDQUFRO2FBQVosVUFBYSxLQUFjO1lBQ3pCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksNENBQVU7YUFBZCxVQUFlLEtBQWE7WUFDMUIsSUFBSSxLQUFLLElBQUksS0FBSyxLQUFLLElBQUksQ0FBQyxXQUFXLEVBQUU7Z0JBQ3ZDLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO2dCQUN6QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7YUFDckI7UUFDSCxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDRDQUFVO2FBQWQsVUFBZSxLQUFhO1lBQzFCLElBQUksS0FBSyxJQUFJLEtBQUssS0FBSyxJQUFJLENBQUMsVUFBVSxFQUFFO2dCQUN0QyxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztnQkFDekIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO2FBQ3JCO1FBQ0gsQ0FBQzs7O09BQUE7SUFPRCxzQkFBSSx1Q0FBSzthQUFUO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3pCLENBQUM7OztPQUFBO0lBSUQsdUNBQVEsR0FBUixVQUFTLFNBQVM7UUFBbEIsaUJBMENDO1FBekNDLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLFNBQVM7YUFDTixHQUFHLENBQUMsVUFBVSxDQUFDO2FBQ2YsSUFBSSxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSyxPQUFBLENBQUMsR0FBRyxDQUFDLEVBQUwsQ0FBSyxDQUFDO2FBQ3JCLEdBQUcsQ0FBQyxVQUFBLEtBQUs7O1lBQ1IsSUFBTSxRQUFRLEdBQUc7Z0JBQ2YsU0FBUyxFQUFFLEVBQUU7Z0JBQ2IsS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsU0FBUyxFQUFFLEVBQUU7Z0JBQ2IsS0FBSyxFQUFFLEVBQUU7YUFDVixDQUFDO1lBQ0YsSUFBTSxTQUFTLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNyQyxJQUFNLGlCQUFpQixHQUFHLE9BQU8sU0FBUyxLQUFLLFFBQVEsQ0FBQztZQUN4RCxJQUFNLFNBQVMsR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQ2xFLElBQUksQ0FBQyxTQUFTLElBQUksU0FBUyxLQUFLLENBQUMsRUFBRTtnQkFDakMsT0FBTyxJQUFJLENBQUM7YUFDYjtZQUNELElBQU0sUUFBUSxHQUNaLENBQUMsQ0FBQyxLQUFJLENBQUMsU0FBUyxJQUFJLEtBQUssS0FBSyxLQUFJLENBQUMsV0FBVyxDQUFDO2dCQUMvQyxDQUFDLEtBQUksQ0FBQyxTQUFTLElBQUksS0FBSyxJQUFJLEtBQUksQ0FBQyxXQUFXLElBQUksS0FBSyxJQUFJLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUM3RSxJQUFNLGFBQWE7Z0JBQ2pCLEdBQUksS0FBSSxDQUFDLFVBQVUsVUFBTyxJQUFHLElBQUk7Z0JBQ2pDLEdBQUksS0FBSSxDQUFDLFVBQVUsaUJBQWMsSUFBRyxRQUFRO21CQUM3QyxDQUFDO1lBQ0YsSUFBTSxXQUFXLEdBQUc7Z0JBQ2xCLFlBQVksRUFBRSxNQUFNO2dCQUNwQixNQUFNLEVBQUssQ0FBQyxDQUFDLEtBQUssR0FBRyxLQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsTUFBRzthQUN4RCxDQUFDO1lBQ0YsSUFBTSxTQUFTLEdBQUc7Z0JBQ2hCLEtBQUssRUFBSyxLQUFJLENBQUMsVUFBVSxNQUFHO2dCQUM1QixVQUFVLEVBQUssQ0FBQyxLQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsTUFBRztnQkFDdEMsSUFBSSxFQUFLLENBQUMsQ0FBQyxLQUFLLEdBQUcsS0FBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLE1BQUc7YUFDdEQsQ0FBQztZQUNGLElBQU0sS0FBSyxHQUFHLFNBQVMsQ0FBQztZQUN4QixJQUFNLFNBQVMsR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLHVCQUFNLEtBQUssR0FBSyxTQUFTLENBQUMsS0FBSyxFQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFDL0UsUUFBUSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7WUFDL0IsUUFBUSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7WUFDdkIsUUFBUSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMxRCxRQUFRLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQztZQUMzQixLQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCwyQ0FBWSxHQUFaOztRQUNFLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM5QyxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUN0QyxJQUFNLFFBQVEsR0FDWixDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxLQUFLLEtBQUssSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDL0MsQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsV0FBVyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDN0UsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO2dCQUN6QixHQUFJLElBQUksQ0FBQyxVQUFVLFVBQU8sSUFBRyxJQUFJO2dCQUNqQyxHQUFJLElBQUksQ0FBQyxVQUFVLGlCQUFjLElBQUcsUUFBUTttQkFDN0MsQ0FBQztTQUNIO0lBQ0gsQ0FBQztJQUVELDRDQUFhLEdBQWI7UUFDRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDOUMsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3RixPQUFPLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1NBQ2pEO0lBQ0gsQ0FBQztJQUVELHVDQUFRLEdBQVI7UUFDRSxJQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMzQyxJQUFNLFVBQVUsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDO1FBQ3BDLElBQU0sSUFBSSxHQUFHLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQzNELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxHQUFHLEdBQUcsQ0FBQztRQUM3QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUNwQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFFRCw4Q0FBZSxHQUFmO1FBQ0UsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7O2dCQTdFeUIsVUFBVTs7SUEzQ3BDO1FBREMsS0FBSyxFQUFFOzs7bURBS1A7SUFFRDtRQURDLEtBQUssRUFBRTs7O21EQUtQO0lBRUQ7UUFEQyxLQUFLLEVBQUU7OztxREFHUDtJQUVEO1FBREMsS0FBSyxFQUFFOzs7d0RBR1A7SUFFRDtRQURDLEtBQUssRUFBRTs7OzBEQU1QO0lBRUQ7UUFEQyxLQUFLLEVBQUU7OzswREFNUDtJQUVEO1FBREMsTUFBTSxFQUFFOzswREFDMEI7SUFFbkM7UUFEQyxNQUFNLEVBQUU7OytEQUMrQjtJQUd4QztRQURDLFdBQVcsRUFBRTs7O3FEQUdiO0lBdkRVLG9CQUFvQjtRQUxoQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsK0JBQStCO1lBQ3pDLG1IQUE0QztZQUM1QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtTQUN0QyxDQUFDO3lDQTBEMEIsVUFBVTtPQXpEekIsb0JBQW9CLENBdUloQztJQUFELDJCQUFDO0NBQUEsQUF2SUQsSUF1SUM7U0F2SVksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIEVsZW1lbnRSZWYsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgSG9zdEJpbmRpbmcsXG4gIFZpZXdFbmNhcHN1bGF0aW9uXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdTbGlkZXJNYXJrcywgbnptLXNsaWRlci1tYXJrcycsXG4gIHRlbXBsYXRlVXJsOiAnLi9zbGlkZXItbWFya3MuY29tcG9uZW50Lmh0bWwnLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIFNsaWRlck1hcmtzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcbiAgbWFya0FycmF5OiBBcnJheTxhbnk+ID0gW107XG5cbiAgcHJpdmF0ZSBfbWluOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIF9tYXg6IG51bWJlciA9IDEwMDtcbiAgcHJpdmF0ZSBfbWFya3M6IG9iamVjdCA9IHt9O1xuICBwcml2YXRlIF9pbmNsdWRlZDogYm9vbGVhbiA9IHRydWU7XG4gIHByaXZhdGUgX2NsYXNzTmFtZTogc3RyaW5nID0gJ2FtLXNsaWRlci1tYXJrJztcbiAgcHJpdmF0ZSBfdXBwZXJCb3VuZDogbnVtYmVyO1xuICBwcml2YXRlIF9sb3dlckJvdW5kOiBudW1iZXI7XG4gIHByaXZhdGUgX3JhbmdlOiBudW1iZXI7XG4gIHByaXZhdGUgX21hcmtXaWR0aDogbnVtYmVyO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBtaW4odmFsdWU6IG51bWJlcikge1xuICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSA8PSB0aGlzLl9tYXgpIHtcbiAgICAgIHRoaXMuX21pbiA9IHZhbHVlO1xuICAgIH1cbiAgfVxuICBASW5wdXQoKVxuICBzZXQgbWF4KHZhbHVlOiBudW1iZXIpIHtcbiAgICBpZiAodmFsdWUgJiYgdmFsdWUgPj0gdGhpcy5fbWluKSB7XG4gICAgICB0aGlzLl9tYXggPSB2YWx1ZTtcbiAgICB9XG4gIH1cbiAgQElucHV0KClcbiAgc2V0IG1hcmtzKHZhbHVlOiBvYmplY3QpIHtcbiAgICB0aGlzLl9tYXJrcyA9IHZhbHVlO1xuICB9XG4gIEBJbnB1dCgpXG4gIHNldCBpbmNsdWRlZCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2luY2x1ZGVkID0gdmFsdWU7XG4gIH1cbiAgQElucHV0KClcbiAgc2V0IHVwcGVyQm91bmQodmFsdWU6IG51bWJlcikge1xuICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSAhPT0gdGhpcy5fdXBwZXJCb3VuZCkge1xuICAgICAgdGhpcy5fdXBwZXJCb3VuZCA9IHZhbHVlO1xuICAgICAgdGhpcy5zZXRBY3RpdmVDbHMoKTtcbiAgICB9XG4gIH1cbiAgQElucHV0KClcbiAgc2V0IGxvd2VyQm91bmQodmFsdWU6IG51bWJlcikge1xuICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSAhPT0gdGhpcy5sb3dlckJvdW5kKSB7XG4gICAgICB0aGlzLl9sb3dlckJvdW5kID0gdmFsdWU7XG4gICAgICB0aGlzLnNldEFjdGl2ZUNscygpO1xuICAgIH1cbiAgfVxuICBAT3V0cHV0KClcbiAgb25DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpXG4gIG9uQWZ0ZXJDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBASG9zdEJpbmRpbmcoKVxuICBnZXQgY2xhc3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NsYXNzTmFtZTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX2VsZjogRWxlbWVudFJlZikge31cblxuICBnZXRNYXJrcyhtYXJrc0tleXMpIHtcbiAgICB0aGlzLm1hcmtBcnJheSA9IFtdO1xuICAgIG1hcmtzS2V5c1xuICAgICAgLm1hcChwYXJzZUZsb2F0KVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGEgLSBiKVxuICAgICAgLm1hcChwb2ludCA9PiB7XG4gICAgICAgIGNvbnN0IG1hcmtJdGVtID0ge1xuICAgICAgICAgIG1hcmtMYWJlbDogJycsXG4gICAgICAgICAgcG9pbnQ6ICcnLFxuICAgICAgICAgIGNsYXNzTmFtZToge30sXG4gICAgICAgICAgc3R5bGU6IHt9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IG1hcmtQb2ludCA9IHRoaXMuX21hcmtzW3BvaW50XTtcbiAgICAgICAgY29uc3QgbWFya1BvaW50SXNPYmplY3QgPSB0eXBlb2YgbWFya1BvaW50ID09PSAnb2JqZWN0JztcbiAgICAgICAgY29uc3QgbWFya0xhYmVsID0gbWFya1BvaW50SXNPYmplY3QgPyBtYXJrUG9pbnQubGFiZWwgOiBtYXJrUG9pbnQ7XG4gICAgICAgIGlmICghbWFya0xhYmVsICYmIG1hcmtMYWJlbCAhPT0gMCkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzQWN0aXZlID1cbiAgICAgICAgICAoIXRoaXMuX2luY2x1ZGVkICYmIHBvaW50ID09PSB0aGlzLl91cHBlckJvdW5kKSB8fFxuICAgICAgICAgICh0aGlzLl9pbmNsdWRlZCAmJiBwb2ludCA8PSB0aGlzLl91cHBlckJvdW5kICYmIHBvaW50ID49IHRoaXMuX2xvd2VyQm91bmQpO1xuICAgICAgICBjb25zdCBtYXJrQ2xhc3NOYW1lID0ge1xuICAgICAgICAgIFtgJHt0aGlzLl9jbGFzc05hbWV9LXRleHRgXTogdHJ1ZSxcbiAgICAgICAgICBbYCR7dGhpcy5fY2xhc3NOYW1lfS10ZXh0LWFjdGl2ZWBdOiBpc0FjdGl2ZVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBib3R0b21TdHlsZSA9IHtcbiAgICAgICAgICBtYXJnaW5Cb3R0b206ICctNTAlJyxcbiAgICAgICAgICBib3R0b206IGAkeygocG9pbnQgLSB0aGlzLl9taW4pIC8gdGhpcy5fcmFuZ2UpICogMTAwfSVgXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGxlZnRTdHlsZSA9IHtcbiAgICAgICAgICB3aWR0aDogYCR7dGhpcy5fbWFya1dpZHRofSVgLFxuICAgICAgICAgIG1hcmdpbkxlZnQ6IGAkey10aGlzLl9tYXJrV2lkdGggLyAyfSVgLFxuICAgICAgICAgIGxlZnQ6IGAkeygocG9pbnQgLSB0aGlzLl9taW4pIC8gdGhpcy5fcmFuZ2UpICogMTAwfSVgXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHN0eWxlID0gbGVmdFN0eWxlO1xuICAgICAgICBjb25zdCBtYXJrU3R5bGUgPSBtYXJrUG9pbnRJc09iamVjdCA/IHsgLi4uc3R5bGUsIC4uLm1hcmtQb2ludC5zdHlsZSB9IDogc3R5bGU7XG4gICAgICAgIG1hcmtJdGVtLm1hcmtMYWJlbCA9IG1hcmtMYWJlbDtcbiAgICAgICAgbWFya0l0ZW0ucG9pbnQgPSBwb2ludDtcbiAgICAgICAgbWFya0l0ZW0uY2xhc3NOYW1lID0gT2JqZWN0LmtleXMobWFya0NsYXNzTmFtZSkuam9pbignICcpO1xuICAgICAgICBtYXJrSXRlbS5zdHlsZSA9IG1hcmtTdHlsZTtcbiAgICAgICAgdGhpcy5tYXJrQXJyYXkucHVzaChtYXJrSXRlbSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHNldEFjdGl2ZUNscygpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubWFya0FycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBwb2ludCA9IHRoaXMubWFya0FycmF5W2ldLnBvaW50O1xuICAgICAgY29uc3QgaXNBY3RpdmUgPVxuICAgICAgICAoIXRoaXMuX2luY2x1ZGVkICYmIHBvaW50ID09PSB0aGlzLl91cHBlckJvdW5kKSB8fFxuICAgICAgICAodGhpcy5faW5jbHVkZWQgJiYgcG9pbnQgPD0gdGhpcy5fdXBwZXJCb3VuZCAmJiBwb2ludCA+PSB0aGlzLl9sb3dlckJvdW5kKTtcbiAgICAgIHRoaXMubWFya0FycmF5W2ldLmNsYXNzTmFtZSA9IHtcbiAgICAgICAgW2Ake3RoaXMuX2NsYXNzTmFtZX0tdGV4dGBdOiB0cnVlLFxuICAgICAgICBbYCR7dGhpcy5fY2xhc3NOYW1lfS10ZXh0LWFjdGl2ZWBdOiBpc0FjdGl2ZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBzZXRNYXJrc0xhYmxlKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tYXJrQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IG1hcmtFbGUgPSB0aGlzLl9lbGYubmF0aXZlRWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuX2NsYXNzTmFtZSArICctdGV4dCcpW2ldO1xuICAgICAgbWFya0VsZS5pbm5lckhUTUwgPSB0aGlzLm1hcmtBcnJheVtpXS5tYXJrTGFiZWw7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgY29uc3QgbWFya3NLZXlzID0gT2JqZWN0LmtleXModGhpcy5fbWFya3MpO1xuICAgIGNvbnN0IG1hcmtzQ291bnQgPSBtYXJrc0tleXMubGVuZ3RoO1xuICAgIGNvbnN0IHVuaXQgPSBtYXJrc0NvdW50ID4gMSA/IDEwMCAvIChtYXJrc0NvdW50IC0gMSkgOiAxMDA7XG4gICAgdGhpcy5fbWFya1dpZHRoID0gdW5pdCAqIDAuOTtcbiAgICB0aGlzLl9yYW5nZSA9IHRoaXMuX21heCAtIHRoaXMuX21pbjtcbiAgICB0aGlzLmdldE1hcmtzKG1hcmtzS2V5cyk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5zZXRNYXJrc0xhYmxlKCk7XG4gIH1cbn1cbiJdfQ==