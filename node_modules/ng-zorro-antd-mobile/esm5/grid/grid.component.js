import { __decorate, __metadata } from "tslib";
import { Component, Input, Output, EventEmitter, TemplateRef, HostBinding } from '@angular/core';
var GridComponent = /** @class */ (function () {
    function GridComponent() {
        this.wrapCls = {};
        this.itemCls = {};
        this.carouselProps = {
            dots: false,
            dragging: false
        };
        this.defaultProps = {
            data: [],
            hasLine: true,
            isCarousel: false,
            columnNum: 4,
            carouselMaxRow: 2,
            prefixCls: 'am-grid',
            square: true,
            itemStyle: {}
        };
        this.carouselData = [];
        this.carouselDataTmp = [];
        this.gridData = [];
        this._data = [];
        this.columnNum = 4;
        this.carouselMaxRow = 2;
        this.itemStyle = {};
        this.square = true;
        this.hasLine = true;
        this.activeStyle = true;
        this.onClick = new EventEmitter();
        this.amGrid = true;
    }
    Object.defineProperty(GridComponent.prototype, "isCarousel", {
        get: function () {
            return this.defaultProps.isCarousel;
        },
        set: function (value) {
            this.defaultProps.isCarousel = value;
            this.init();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "data", {
        set: function (value) {
            this._data = value;
            this.init();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "amGridSquare", {
        get: function () {
            return true === this.square;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "amGridLine", {
        get: function () {
            return true === this.hasLine;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridComponent.prototype, "amGridCarousel", {
        get: function () {
            return true === this.isCarousel;
        },
        enumerable: true,
        configurable: true
    });
    GridComponent.prototype.getContentType = function (value) {
        if ((value.indexOf('http') >= 0 || value.indexOf('assets') >= 0) && value.indexOf('<') < 0) {
            return 'url';
        }
        else if (value.indexOf('<') >= 0) {
            return 'innerHTML';
        }
        else if (value instanceof TemplateRef) {
            return 'TemplateRef';
        }
        else {
            return 'icon';
        }
    };
    GridComponent.prototype.init = function () {
        var dataLength = (this._data && this._data.length) || 0;
        var rowCount = Math.ceil(dataLength / this.columnNum);
        var rowsArr;
        if (this.defaultProps.isCarousel) {
            if (rowCount % this.carouselMaxRow !== 0) {
                rowCount = rowCount + this.carouselMaxRow - (rowCount % this.carouselMaxRow);
            }
            var pageCount = Math.ceil(rowCount / this.carouselMaxRow);
            rowsArr = this.getRows(rowCount, dataLength);
            if (pageCount <= 1) {
                this.carouselProps = {
                    dots: false,
                    dragging: false
                };
            }
            else {
                this.carouselProps = {
                    dots: true,
                    dragging: true
                };
            }
            this.carouselDataTmp = this.getCarouselData(rowsArr, pageCount, rowCount);
        }
        else {
            this.gridData = this.getRows(rowCount, dataLength);
        }
    };
    GridComponent.prototype.getCarouselData = function (rowsArr, pageCount, rowCount) {
        var pagesArr = [];
        for (var pageIndex = 0; pageIndex < pageCount; pageIndex++) {
            var pageRows = [];
            for (var ii = 0; ii < this.carouselMaxRow; ii++) {
                var rowIndex = pageIndex * this.carouselMaxRow + ii;
                if (rowIndex < rowCount) {
                    pageRows.push(rowsArr[rowIndex]);
                }
                else {
                    // 空节点为了确保末尾页的最后未到底的行有底线(样式中last-child会没线)
                    pageRows.push(null);
                }
            }
            pagesArr.push(pageRows);
        }
        return pagesArr;
    };
    GridComponent.prototype.getRows = function (rowCount, dataLength) {
        var columnNum = this.columnNum;
        var rowArr = new Array();
        for (var i = 0; i < rowCount; i++) {
            rowArr[i] = new Array();
            for (var j = 0; j < columnNum; j++) {
                var dataIndex = i * columnNum + j;
                if (dataIndex < dataLength) {
                    rowArr[i][j] = this._data[dataIndex];
                }
                else {
                    rowArr[i][j] = null;
                }
            }
        }
        return rowArr;
    };
    GridComponent.prototype.click = function (data, index) {
        var outputData = {
            data: data,
            index: index
        };
        this.onClick.emit(outputData);
    };
    GridComponent.prototype.ngOnInit = function () {
        var _a;
        this.itemCls = (_a = {},
            _a[this.defaultProps.prefixCls + "-item"] = true,
            _a[this.defaultProps.prefixCls + "-active-item"] = false,
            _a);
    };
    __decorate([
        Input(),
        __metadata("design:type", Number)
    ], GridComponent.prototype, "columnNum", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Number)
    ], GridComponent.prototype, "carouselMaxRow", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], GridComponent.prototype, "itemStyle", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], GridComponent.prototype, "square", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], GridComponent.prototype, "hasLine", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], GridComponent.prototype, "isCarousel", null);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], GridComponent.prototype, "activeStyle", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], GridComponent.prototype, "data", null);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], GridComponent.prototype, "onClick", void 0);
    __decorate([
        HostBinding('class.am-grid'),
        __metadata("design:type", Boolean)
    ], GridComponent.prototype, "amGrid", void 0);
    __decorate([
        HostBinding('class.am-grid-square'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [])
    ], GridComponent.prototype, "amGridSquare", null);
    __decorate([
        HostBinding('class.am-grid-line'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [])
    ], GridComponent.prototype, "amGridLine", null);
    __decorate([
        HostBinding('class.am-grid-carousel'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [])
    ], GridComponent.prototype, "amGridCarousel", null);
    GridComponent = __decorate([
        Component({
            selector: 'Grid, nzm-grid',
            template: "<ng-container *ngIf=\"!isCarousel\">\n  <Flex *ngFor=\"let item of gridData; let i = index\" [justify]=\"'center'\" [align]=\"'stretch'\">\n    <FlexItem\n      TouchFeedbackDirective\n      *ngFor=\"let subItem of item; let j = index\"\n      [ngClass]=\"itemCls\"\n      [ngStyle]=\"itemStyle\"\n      [className]=\"['am-grid-item-active']\"\n      [activeStyle]=\"activeStyle\"\n    >\n      <div\n        *ngIf=\"subItem !== null\"\n        class=\"{{ defaultProps.prefixCls }}-item-content\"\n        (click)=\"click(subItem, i * columnNum + j)\"\n      >\n        <div class=\"{{ defaultProps.prefixCls }}-item-inner-content column-num-{{ columnNum }}\">\n          <img\n            *ngIf=\"subItem.icon && getContentType(subItem.icon) === 'url'\"\n            src=\"{{ subItem.icon }}\"\n            class=\"{{ defaultProps.prefixCls }}-icon\"\n          />\n          <Icon\n            *ngIf=\"subItem.icon && getContentType(subItem.icon) === 'icon'\"\n            [type]=\"subItem.icon\"\n            [size]=\"subItem.size\"\n          ></Icon>\n          <div\n            *ngIf=\"subItem.icon && getContentType(subItem.icon) === 'innerHTML'\"\n            [innerHTML]=\"subItem.icon | safeHTML\"\n          ></div>\n          <ng-template\n            *ngIf=\"subItem.icon && getContentType(subItem.icon) === 'TemplateRef'\"\n            [ngTemplateOutlet]=\"subItem.icon\"\n          ></ng-template>\n          <div class=\"{{ defaultProps.prefixCls }}-text\">{{ subItem.text }}</div>\n        </div>\n      </div>\n      <div *ngIf=\"subItem === null\" class=\"{{ defaultProps.prefixCls }}-null-item\"></div>\n    </FlexItem>\n  </Flex>\n  <ng-content></ng-content>\n</ng-container>\n\n<Carousel\n  *ngIf=\"isCarousel && carouselDataTmp.length > 0\"\n  [autoplay]=\"false\"\n  [infinite]=\"true\"\n  [selectedIndex]=\"0\"\n  [autoplayInterval]=\"3000\"\n  [dots]=\"carouselProps.dots\"\n  [dragging]=\"carouselProps.dragging\"\n>\n  <CarouselSlide\n    *ngFor=\"let gridData of carouselDataTmp\"\n    class=\"{{ defaultProps.prefixCls }}-carousel-page\"\n    style=\"display: block;\"\n  >\n    <Flex *ngFor=\"let item of gridData; let i = index\" [justify]=\"'center'\" [align]=\"'stretch'\">\n      <FlexItem\n        TouchFeedbackDirective\n        *ngFor=\"let subItem of item; let j = index\"\n        class=\"{{ defaultProps.prefixCls }}-item\"\n        [ngStyle]=\"itemStyle\"\n        [className]=\"['am-grid-item-active']\"\n      >\n        <div\n          *ngIf=\"subItem !== null\"\n          class=\"{{ defaultProps.prefixCls }}-item-content\"\n          (click)=\"click(subItem, i * columnNum + j)\"\n        >\n          <div class=\"{{ defaultProps.prefixCls }}-item-inner-content column-num-4\">\n            <img class=\"{{ defaultProps.prefixCls }}-icon\" src=\"{{ subItem.icon }}\" />\n            <div class=\"{{ defaultProps.prefixCls }}-text\">{{ subItem.text }}</div>\n          </div>\n        </div>\n        <div *ngIf=\"subItem === null\" class=\"{{ defaultProps.prefixCls }}-null-item\"></div>\n      </FlexItem>\n    </Flex>\n  </CarouselSlide>\n</Carousel>\n"
        }),
        __metadata("design:paramtypes", [])
    ], GridComponent);
    return GridComponent;
}());
export { GridComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy16b3Jyby1hbnRkLW1vYmlsZS8iLCJzb3VyY2VzIjpbImdyaWQvZ3JpZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU16RztJQWtFRTtRQWpFQSxZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLGtCQUFhLEdBQUc7WUFDZCxJQUFJLEVBQUUsS0FBSztZQUNYLFFBQVEsRUFBRSxLQUFLO1NBQ2hCLENBQUM7UUFDRixpQkFBWSxHQUFHO1lBQ2IsSUFBSSxFQUFFLEVBQUU7WUFDUixPQUFPLEVBQUUsSUFBSTtZQUNiLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLFNBQVMsRUFBRSxDQUFDO1lBQ1osY0FBYyxFQUFFLENBQUM7WUFDakIsU0FBUyxFQUFFLFNBQVM7WUFDcEIsTUFBTSxFQUFFLElBQUk7WUFDWixTQUFTLEVBQUUsRUFBRTtTQUNkLENBQUM7UUFDRixpQkFBWSxHQUFHLEVBQUUsQ0FBQztRQUNsQixvQkFBZSxHQUFHLEVBQUUsQ0FBQztRQUNyQixhQUFRLEdBQUcsRUFBRSxDQUFDO1FBRU4sVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUduQixjQUFTLEdBQVcsQ0FBQyxDQUFDO1FBRXRCLG1CQUFjLEdBQVcsQ0FBQyxDQUFDO1FBRTNCLGNBQVMsR0FBVyxFQUFFLENBQUM7UUFFdkIsV0FBTSxHQUFZLElBQUksQ0FBQztRQUV2QixZQUFPLEdBQVksSUFBSSxDQUFDO1FBVXhCLGdCQUFXLEdBQVksSUFBSSxDQUFDO1FBTzVCLFlBQU8sR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUdoRCxXQUFNLEdBQVksSUFBSSxDQUFDO0lBY1IsQ0FBQztJQWhDaEIsc0JBQUks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O2tEQUEyQjtJQUdoRDtRQURDLFdBQVcsQ0FBQyxlQUFlLENBQUM7O2lEQUNOO0lBRXZCO1FBREMsV0FBVyxDQUFDLHNCQUFzQixDQUFDOzs7cURBR25DO0lBRUQ7UUFEQyxXQUFXLENBQUMsb0JBQW9CLENBQUM7OzttREFHakM7SUFFRDtRQURDLFdBQVcsQ0FBQyx3QkFBd0IsQ0FBQzs7O3VEQUdyQztJQWhFVSxhQUFhO1FBSnpCLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxnQkFBZ0I7WUFDMUIsNGlHQUFvQztTQUNyQyxDQUFDOztPQUNXLGFBQWEsQ0E0SnpCO0lBQUQsb0JBQUM7Q0FBQSxBQTVKRCxJQTRKQztTQTVKWSxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVGVtcGxhdGVSZWYsIEhvc3RCaW5kaW5nIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ0dyaWQsIG56bS1ncmlkJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2dyaWQuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIEdyaWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICB3cmFwQ2xzID0ge307XG4gIGl0ZW1DbHMgPSB7fTtcbiAgY2Fyb3VzZWxQcm9wcyA9IHtcbiAgICBkb3RzOiBmYWxzZSxcbiAgICBkcmFnZ2luZzogZmFsc2VcbiAgfTtcbiAgZGVmYXVsdFByb3BzID0ge1xuICAgIGRhdGE6IFtdLFxuICAgIGhhc0xpbmU6IHRydWUsXG4gICAgaXNDYXJvdXNlbDogZmFsc2UsXG4gICAgY29sdW1uTnVtOiA0LFxuICAgIGNhcm91c2VsTWF4Um93OiAyLFxuICAgIHByZWZpeENsczogJ2FtLWdyaWQnLFxuICAgIHNxdWFyZTogdHJ1ZSxcbiAgICBpdGVtU3R5bGU6IHt9XG4gIH07XG4gIGNhcm91c2VsRGF0YSA9IFtdO1xuICBjYXJvdXNlbERhdGFUbXAgPSBbXTtcbiAgZ3JpZERhdGEgPSBbXTtcblxuICBwcml2YXRlIF9kYXRhID0gW107XG5cbiAgQElucHV0KClcbiAgY29sdW1uTnVtOiBudW1iZXIgPSA0O1xuICBASW5wdXQoKVxuICBjYXJvdXNlbE1heFJvdzogbnVtYmVyID0gMjtcbiAgQElucHV0KClcbiAgaXRlbVN0eWxlOiBvYmplY3QgPSB7fTtcbiAgQElucHV0KClcbiAgc3F1YXJlOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KClcbiAgaGFzTGluZTogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpXG4gIGdldCBpc0Nhcm91c2VsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmRlZmF1bHRQcm9wcy5pc0Nhcm91c2VsO1xuICB9XG4gIHNldCBpc0Nhcm91c2VsKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5kZWZhdWx0UHJvcHMuaXNDYXJvdXNlbCA9IHZhbHVlO1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG4gIEBJbnB1dCgpXG4gIGFjdGl2ZVN0eWxlOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KClcbiAgc2V0IGRhdGEodmFsdWU6IEFycmF5PGFueT4pIHtcbiAgICB0aGlzLl9kYXRhID0gdmFsdWU7XG4gICAgdGhpcy5pbml0KCk7XG4gIH1cbiAgQE91dHB1dCgpXG4gIG9uQ2xpY2s6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuYW0tZ3JpZCcpXG4gIGFtR3JpZDogYm9vbGVhbiA9IHRydWU7XG4gIEBIb3N0QmluZGluZygnY2xhc3MuYW0tZ3JpZC1zcXVhcmUnKVxuICBnZXQgYW1HcmlkU3F1YXJlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0cnVlID09PSB0aGlzLnNxdWFyZTtcbiAgfVxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmFtLWdyaWQtbGluZScpXG4gIGdldCBhbUdyaWRMaW5lKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0cnVlID09PSB0aGlzLmhhc0xpbmU7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5hbS1ncmlkLWNhcm91c2VsJylcbiAgZ2V0IGFtR3JpZENhcm91c2VsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0cnVlID09PSB0aGlzLmlzQ2Fyb3VzZWw7XG4gIH1cblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgZ2V0Q29udGVudFR5cGUodmFsdWU6IGFueSk6IHN0cmluZyB7XG4gICAgaWYgKCh2YWx1ZS5pbmRleE9mKCdodHRwJykgPj0gMCB8fCB2YWx1ZS5pbmRleE9mKCdhc3NldHMnKSA+PSAwKSAmJiB2YWx1ZS5pbmRleE9mKCc8JykgPCAwKSB7XG4gICAgICByZXR1cm4gJ3VybCc7XG4gICAgfSBlbHNlIGlmICh2YWx1ZS5pbmRleE9mKCc8JykgPj0gMCkge1xuICAgICAgcmV0dXJuICdpbm5lckhUTUwnO1xuICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZikge1xuICAgICAgcmV0dXJuICdUZW1wbGF0ZVJlZic7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnaWNvbic7XG4gICAgfVxuICB9XG5cbiAgaW5pdCgpIHtcbiAgICBjb25zdCBkYXRhTGVuZ3RoID0gKHRoaXMuX2RhdGEgJiYgdGhpcy5fZGF0YS5sZW5ndGgpIHx8IDA7XG4gICAgbGV0IHJvd0NvdW50ID0gTWF0aC5jZWlsKGRhdGFMZW5ndGggLyB0aGlzLmNvbHVtbk51bSk7XG4gICAgbGV0IHJvd3NBcnI7XG4gICAgaWYgKHRoaXMuZGVmYXVsdFByb3BzLmlzQ2Fyb3VzZWwpIHtcbiAgICAgIGlmIChyb3dDb3VudCAlIHRoaXMuY2Fyb3VzZWxNYXhSb3cgIT09IDApIHtcbiAgICAgICAgcm93Q291bnQgPSByb3dDb3VudCArIHRoaXMuY2Fyb3VzZWxNYXhSb3cgLSAocm93Q291bnQgJSB0aGlzLmNhcm91c2VsTWF4Um93KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHBhZ2VDb3VudCA9IE1hdGguY2VpbChyb3dDb3VudCAvIHRoaXMuY2Fyb3VzZWxNYXhSb3cpO1xuICAgICAgcm93c0FyciA9IHRoaXMuZ2V0Um93cyhyb3dDb3VudCwgZGF0YUxlbmd0aCk7XG4gICAgICBpZiAocGFnZUNvdW50IDw9IDEpIHtcbiAgICAgICAgdGhpcy5jYXJvdXNlbFByb3BzID0ge1xuICAgICAgICAgIGRvdHM6IGZhbHNlLFxuICAgICAgICAgIGRyYWdnaW5nOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jYXJvdXNlbFByb3BzID0ge1xuICAgICAgICAgIGRvdHM6IHRydWUsXG4gICAgICAgICAgZHJhZ2dpbmc6IHRydWVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2Fyb3VzZWxEYXRhVG1wID0gdGhpcy5nZXRDYXJvdXNlbERhdGEocm93c0FyciwgcGFnZUNvdW50LCByb3dDb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ3JpZERhdGEgPSB0aGlzLmdldFJvd3Mocm93Q291bnQsIGRhdGFMZW5ndGgpO1xuICAgIH1cbiAgfVxuXG4gIGdldENhcm91c2VsRGF0YShyb3dzQXJyOiBhbnlbXSwgcGFnZUNvdW50OiBudW1iZXIsIHJvd0NvdW50OiBudW1iZXIpIHtcbiAgICBjb25zdCBwYWdlc0FycjogYW55W10gPSBbXTtcbiAgICBmb3IgKGxldCBwYWdlSW5kZXggPSAwOyBwYWdlSW5kZXggPCBwYWdlQ291bnQ7IHBhZ2VJbmRleCsrKSB7XG4gICAgICBjb25zdCBwYWdlUm93czogYW55W10gPSBbXTtcbiAgICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCB0aGlzLmNhcm91c2VsTWF4Um93OyBpaSsrKSB7XG4gICAgICAgIGNvbnN0IHJvd0luZGV4ID0gcGFnZUluZGV4ICogdGhpcy5jYXJvdXNlbE1heFJvdyArIGlpO1xuICAgICAgICBpZiAocm93SW5kZXggPCByb3dDb3VudCkge1xuICAgICAgICAgIHBhZ2VSb3dzLnB1c2gocm93c0Fycltyb3dJbmRleF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOepuuiKgueCueS4uuS6huehruS/neacq+WwvumhteeahOacgOWQjuacquWIsOW6leeahOihjOacieW6lee6vyjmoLflvI/kuK1sYXN0LWNoaWxk5Lya5rKh57q/KVxuICAgICAgICAgIHBhZ2VSb3dzLnB1c2gobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHBhZ2VzQXJyLnB1c2gocGFnZVJvd3MpO1xuICAgIH1cbiAgICByZXR1cm4gcGFnZXNBcnI7XG4gIH1cblxuICBnZXRSb3dzKHJvd0NvdW50OiBudW1iZXIsIGRhdGFMZW5ndGg6IG51bWJlcikge1xuICAgIGNvbnN0IGNvbHVtbk51bSA9IHRoaXMuY29sdW1uTnVtO1xuICAgIGNvbnN0IHJvd0FyciA9IG5ldyBBcnJheSgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93Q291bnQ7IGkrKykge1xuICAgICAgcm93QXJyW2ldID0gbmV3IEFycmF5KCk7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvbHVtbk51bTsgaisrKSB7XG4gICAgICAgIGNvbnN0IGRhdGFJbmRleCA9IGkgKiBjb2x1bW5OdW0gKyBqO1xuICAgICAgICBpZiAoZGF0YUluZGV4IDwgZGF0YUxlbmd0aCkge1xuICAgICAgICAgIHJvd0FycltpXVtqXSA9IHRoaXMuX2RhdGFbZGF0YUluZGV4XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByb3dBcnJbaV1bal0gPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByb3dBcnI7XG4gIH1cblxuICBjbGljayhkYXRhLCBpbmRleCkge1xuICAgIGNvbnN0IG91dHB1dERhdGEgPSB7XG4gICAgICBkYXRhOiBkYXRhLFxuICAgICAgaW5kZXg6IGluZGV4XG4gICAgfTtcbiAgICB0aGlzLm9uQ2xpY2suZW1pdChvdXRwdXREYXRhKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaXRlbUNscyA9IHtcbiAgICAgIFtgJHt0aGlzLmRlZmF1bHRQcm9wcy5wcmVmaXhDbHN9LWl0ZW1gXTogdHJ1ZSxcbiAgICAgIFtgJHt0aGlzLmRlZmF1bHRQcm9wcy5wcmVmaXhDbHN9LWFjdGl2ZS1pdGVtYF06IGZhbHNlXG4gICAgfTtcbiAgfVxufVxuIl19